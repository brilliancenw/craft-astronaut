{% import "_includes/forms" as forms %}

<div class="readable">
    <h2>API Keys</h2>
    <p>Configure your AI provider API keys. These keys are encrypted and stored securely in the database.</p>

    {% if tablesNotReady is defined and tablesNotReady %}
        <div style="background: #fef3c7; border: 2px solid #f59e0b; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
            <h3 style="margin-top: 0; color: #92400e;">Database Tables Pending</h3>
            <p><strong>Environment variables detected!</strong> Your API keys are configured and working.</p>
            <p>To enable database storage and full functionality, run migrations:</p>
            <pre style="background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 4px; margin: 12px 0;"><code>/Applications/MAMP/bin/php/php8.2.26/bin/php craft migrate/all</code></pre>
        </div>
    {% endif %}

    <h3>Claude (Anthropic)</h3>

    {{ forms.autosuggestField({
        label: 'Claude API Key',
        instructions: 'Enter your Claude API key from console.anthropic.com, or use an environment variable like $LAUNCHER_CLAUDE_API_KEY. Current: ' ~ (maskedKeys.claude ?: 'Not set'),
        id: 'claudeApiKey',
        name: 'claudeApiKey',
        value: settings['claudeApiKey'] ?? '',
        suggestEnvVars: true,
        suggestions: craft.cp.getEnvSuggestions(),
        placeholder: 'sk-ant-... or $LAUNCHER_CLAUDE_API_KEY',
        autocomplete: false
    }) }}

    <p class="light"><strong>Note:</strong> Leave blank to keep existing key. Environment variables (starting with $) are recommended for security.</p>

    <hr>

    <h3>OpenAI (Coming Soon)</h3>

    {{ forms.autosuggestField({
        label: 'OpenAI API Key',
        instructions: 'OpenAI provider support coming soon. Current: ' ~ (maskedKeys.openai ?: 'Not set'),
        id: 'openaiApiKey',
        name: 'openaiApiKey',
        value: settings['openaiApiKey'] ?? '',
        suggestEnvVars: true,
        suggestions: craft.cp.getEnvSuggestions(),
        placeholder: 'sk-... or $LAUNCHER_OPENAI_API_KEY',
        disabled: true,
        autocomplete: false
    }) }}

    <hr>

    <h3>Gemini (Google - Coming Soon)</h3>

    {{ forms.autosuggestField({
        label: 'Gemini API Key',
        instructions: 'Gemini provider support coming soon. Current: ' ~ (maskedKeys.gemini ?: 'Not set'),
        id: 'geminiApiKey',
        name: 'geminiApiKey',
        value: settings['geminiApiKey'] ?? '',
        suggestEnvVars: true,
        suggestions: craft.cp.getEnvSuggestions(),
        placeholder: 'AI... or $LAUNCHER_GEMINI_API_KEY',
        disabled: true,
        autocomplete: false
    }) }}

    <hr>

    <div class="readable" style="margin-top: 24px;">
        <h3>Getting API Keys</h3>

        <h4>Claude (Anthropic)</h4>
        <ol>
            <li>Visit <a href="https://console.anthropic.com/" target="_blank" rel="noopener">console.anthropic.com</a></li>
            <li>Sign up or log in to your account</li>
            <li>Navigate to API Keys section</li>
            <li>Create a new API key</li>
            <li>Copy and paste it above or add to your .env file</li>
        </ol>

        <p><strong>Pricing:</strong> Claude API uses a pay-as-you-go model. Visit <a href="https://www.anthropic.com/pricing" target="_blank" rel="noopener">anthropic.com/pricing</a> for current rates.</p>
    </div>
</div>
