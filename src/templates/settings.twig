{% import "_includes/forms" as forms %}

<div class="readable">
    <h2>API Keys</h2>
    <p>Configure your AI provider API keys. These keys are encrypted and stored securely in the database.</p>

    <div class="readable" style="background: #f3f4f6; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
        <h3 style="margin-top: 0;">Recommended: Use Environment Variables</h3>
        <p><strong>Best Practice:</strong> Store API keys in environment variables (.env file) for better security.</p>
        <p>Environment variables are checked first and take priority over database values.</p>
        <ul>
            <li><code>LAUNCHER_CLAUDE_API_KEY</code> - Claude API key</li>
            <li><code>LAUNCHER_OPENAI_API_KEY</code> - OpenAI API key</li>
            <li><code>LAUNCHER_GEMINI_API_KEY</code> - Gemini API key</li>
        </ul>
        <p class="light">If not set via environment variables, keys can be stored encrypted in the database using the fields below.</p>
    </div>

    <hr>

    <h3>Claude (Anthropic)</h3>

    {% if envKeys.claude %}
        <div style="background: #d1fae5; border: 1px solid #10b981; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
            <strong>Environment Variable Set:</strong> Claude API key is configured via <code>LAUNCHER_CLAUDE_API_KEY</code> environment variable.
            This takes priority over any database value.
        </div>
    {% endif %}

    {{ forms.textField({
        label: 'Claude API Key' ~ (envKeys.claude ? ' (Database Fallback)' : ''),
        instructions: envKeys.claude
            ? 'Environment variable is active. This database value will only be used if the env var is removed. Current: ' ~ (maskedKeys.claude ?: 'Not set')
            : 'Enter your Claude API key from console.anthropic.com. Current key: ' ~ (maskedKeys.claude ?: 'Not set'),
        id: 'claudeApiKey',
        name: 'claudeApiKey',
        value: '',
        placeholder: 'sk-ant-...',
        type: 'password',
        autocomplete: 'off',
        disabled: envKeys.claude
    }) }}

    {% if not envKeys.claude %}
        <p class="light"><strong>Note:</strong> Leave blank to keep existing key. Only enter a new key if you want to update it.</p>
    {% endif %}

    <hr>

    <h3>OpenAI (Coming Soon)</h3>

    {% if envKeys.openai %}
        <div style="background: #d1fae5; border: 1px solid #10b981; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
            <strong>Environment Variable Set:</strong> OpenAI API key is configured via <code>LAUNCHER_OPENAI_API_KEY</code> environment variable.
            This takes priority over any database value.
        </div>
    {% endif %}

    {{ forms.textField({
        label: 'OpenAI API Key' ~ (envKeys.openai ? ' (Database Fallback)' : ''),
        instructions: envKeys.openai
            ? 'Environment variable is active. This database value will only be used if the env var is removed. Current: ' ~ (maskedKeys.openai ?: 'Not set')
            : 'OpenAI provider support coming soon. Current key: ' ~ (maskedKeys.openai ?: 'Not set'),
        id: 'openaiApiKey',
        name: 'openaiApiKey',
        value: '',
        placeholder: 'sk-...',
        type: 'password',
        disabled: true,
        autocomplete: 'off'
    }) }}

    <hr>

    <h3>Gemini (Google - Coming Soon)</h3>

    {% if envKeys.gemini %}
        <div style="background: #d1fae5; border: 1px solid #10b981; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
            <strong>Environment Variable Set:</strong> Gemini API key is configured via <code>LAUNCHER_GEMINI_API_KEY</code> environment variable.
            This takes priority over any database value.
        </div>
    {% endif %}

    {{ forms.textField({
        label: 'Gemini API Key' ~ (envKeys.gemini ? ' (Database Fallback)' : ''),
        instructions: envKeys.gemini
            ? 'Environment variable is active. This database value will only be used if the env var is removed. Current: ' ~ (maskedKeys.gemini ?: 'Not set')
            : 'Gemini provider support coming soon. Current key: ' ~ (maskedKeys.gemini ?: 'Not set'),
        id: 'geminiApiKey',
        name: 'geminiApiKey',
        value: '',
        placeholder: 'AI...',
        type: 'password',
        disabled: true,
        autocomplete: 'off'
    }) }}

    <hr>

    <div class="readable" style="margin-top: 24px;">
        <h3>Getting API Keys</h3>

        <h4>Claude (Anthropic)</h4>
        <ol>
            <li>Visit <a href="https://console.anthropic.com/" target="_blank" rel="noopener">console.anthropic.com</a></li>
            <li>Sign up or log in to your account</li>
            <li>Navigate to API Keys section</li>
            <li>Create a new API key</li>
            <li>Copy and paste it above or add to your .env file</li>
        </ol>

        <p><strong>Pricing:</strong> Claude API uses a pay-as-you-go model. Visit <a href="https://www.anthropic.com/pricing" target="_blank" rel="noopener">anthropic.com/pricing</a> for current rates.</p>
    </div>
</div>
